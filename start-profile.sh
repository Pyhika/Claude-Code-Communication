#!/bin/bash

# ğŸŒŸ Profile launcher for Claude-Code-Communication
# core: 4äººã§é–‹å§‹ï¼ˆUI/API/å˜ä½“ãƒ†ã‚¹ãƒˆ/ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆï¼‰
# full: 8äººã«æ‹¡å¼µï¼ˆE2E/æ€§èƒ½/ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ç›£è¦– è¿½åŠ ï¼‰

set -e

PROFILE=""
YES=false
DO_ASSIGN=false
OVERRIDE_WORKERS=""

usage() {
  cat << EOF
ä½¿ã„æ–¹:
  $0 --profile core|full [--yes] [--assign] [--workers N]

ä¾‹:
  # ã‚³ã‚¢ãƒãƒ¼ãƒ ï¼ˆ4äººï¼‰ã§èµ·å‹•
  $0 --profile core --yes

  # ãƒ•ãƒ«ãƒãƒ¼ãƒ ï¼ˆ8äººï¼‰ã§èµ·å‹•ã—ã€å½¹å‰²ã‚’è‡ªå‹•å‰²å½“
  $0 --profile full --yes --assign

  # ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°ã‚’æ˜ç¤ºçš„ã«ä¸Šæ›¸ã
  $0 --profile core --workers 6 --yes
EOF
}

while [[ $# -gt 0 ]]; do
  case "$1" in
    --profile)
      PROFILE="$2"; shift 2;;
    --yes|-y)
      YES=true; shift;;
    --assign)
      DO_ASSIGN=true; shift;;
    --workers)
      OVERRIDE_WORKERS="$2"; shift 2;;
    -h|--help)
      usage; exit 0;;
    *)
      echo "ä¸æ˜ãªå¼•æ•°: $1"; usage; exit 1;;
  esac
done

if [ -z "$PROFILE" ]; then
  echo "--profile ã‚’æŒ‡å®šã—ã¦ãã ã•ã„ (core|full)"; usage; exit 1
fi

case "$PROFILE" in
  core)
    DEFAULT_WORKERS=4;;
  full)
    DEFAULT_WORKERS=8;;
  *)
    echo "ä¸æ˜ãªãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«: $PROFILE"; usage; exit 1;;
esac

NUM=${OVERRIDE_WORKERS:-$DEFAULT_WORKERS}
if ! [[ "$NUM" =~ ^[0-9]+$ ]]; then
  echo "--workers ã®å€¤ãŒä¸æ­£ã§ã™: $NUM"; exit 1
fi
if [ "$NUM" -lt 1 ]; then NUM=1; fi

echo "ğŸ”§ ãƒ—ãƒ­ãƒ•ã‚¡ã‚¤ãƒ«: $PROFILE"
echo "ğŸ‘¥ ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°: $NUM"

echo "ğŸš€ ã‚»ãƒƒãƒˆã‚¢ãƒƒãƒ—å®Ÿè¡Œ..."
NUM_WORKERS="$NUM" ./setup.sh | cat

echo "ğŸ¤– ã‚¨ãƒ¼ã‚¸ã‚§ãƒ³ãƒˆèµ·å‹•..."
NUM_WORKERS="$NUM" ./launch-agents.sh ${YES:+-y} | cat

assign_role() {
  local worker="$1"; shift
  local role_msg="$*"
  ./agent-send.sh "$worker" "$role_msg"
}

if [ "$DO_ASSIGN" = true ]; then
  echo "ğŸ“ å½¹å‰²ã‚’è‡ªå‹•å‰²å½“ã—ã¾ã™ï¼ˆClaudeã®èªè¨¼å®Œäº†å¾Œã«æœ‰åŠ¹ï¼‰..."
  sleep 1
  # boss1 ã¸å…¨ä½“æ–¹é‡
  ./agent-send.sh boss1 "ã‚ãªãŸã¯boss1ã§ã™ã€‚\næœ¬ãƒ—ãƒ­ã‚¸ã‚§ã‚¯ãƒˆã¯ $PROFILE æ§‹æˆã§é–‹å§‹ã—ã¾ã™ã€‚\nå„workerã«å½¹å‰²ã‚’å‰²ã‚Šå½“ã¦ã€10åˆ†ã”ã¨ã®é€²æ—ç¢ºèªã‚’å®Ÿæ–½ã—ã¦ãã ã•ã„ã€‚"

  if [ "$PROFILE" = "core" ]; then
    # ã‚³ã‚¢ï¼ˆ4äººæƒ³å®šï¼‰
    assign_role worker1 "ã‚ãªãŸã¯worker1ã§ã™ã€‚å½¹å‰²: UI/UXå®Ÿè£…ã€‚\nä¸»æ‹…å½“: ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ /ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–/ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã€‚\næˆæœ: ä¸»è¦ãƒšãƒ¼ã‚¸ã®UIå®Ÿè£…ã¨ç°¡æ˜“ã‚³ãƒ³ãƒãƒ¼ãƒãƒ³ãƒˆã€‚"
    assign_role worker2 "ã‚ãªãŸã¯worker2ã§ã™ã€‚å½¹å‰²: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰/APIã€‚\nä¸»æ‹…å½“: APIã‚¨ãƒ³ãƒ‰ãƒã‚¤ãƒ³ãƒˆ/ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«/æ°¸ç¶šåŒ–ã®éª¨çµ„ã¿ã€‚\næˆæœ: CRUDã®æœ€å°å®Ÿè£…ã¨ãƒ˜ãƒ«ã‚¹ãƒã‚§ãƒƒã‚¯ã€‚"
    assign_role worker3 "ã‚ãªãŸã¯worker3ã§ã™ã€‚å½¹å‰²: å˜ä½“ãƒ†ã‚¹ãƒˆ/QAã€‚\nä¸»æ‹…å½“: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆãƒ»lintãƒ»åŸºæœ¬CIã®æ•´å‚™ã€‚\næˆæœ: ä¸»è¦ãƒ¦ãƒ¼ã‚¹ã‚±ãƒ¼ã‚¹ã®ãƒ†ã‚¹ãƒˆã‚«ãƒãƒ¬ãƒƒã‚¸ç¢ºä¿ã€‚"
    assign_role worker4 "ã‚ãªãŸã¯worker4ã§ã™ã€‚å½¹å‰²: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ/DXã€‚\nä¸»æ‹…å½“: README/èµ·å‹•æ‰‹é †/é–‹ç™ºã‚¬ã‚¤ãƒ‰ã€‚\næˆæœ: åˆè¦‹ã§ã‚‚10åˆ†ã§é–‹ç™ºã«å‚åŠ ã§ãã‚‹çŠ¶æ…‹ã€‚"
    # 5,6 ãŒã„ã‚‹å ´åˆã®æ‹¡å¼µï¼ˆä»»æ„ï¼‰
    if [ "$NUM" -ge 5 ]; then
      assign_role worker5 "ã‚ãªãŸã¯worker5ã§ã™ã€‚å½¹å‰²: UI/ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æ”¹å–„ï¼ˆä»»æ„ï¼‰ã€‚\nä¸»æ‹…å½“: Core Web Vitalsã®åˆæœŸæ”¹å–„ã€‚"
    fi
    if [ "$NUM" -ge 6 ]; then
      assign_role worker6 "ã‚ãªãŸã¯worker6ã§ã™ã€‚å½¹å‰²: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£åŸºç›¤ï¼ˆä»»æ„ï¼‰ã€‚\nä¸»æ‹…å½“: åŸºæœ¬çš„ãªå…¥åŠ›æ¤œè¨¼/ãƒ˜ãƒƒãƒ€/ä¾å­˜è„†å¼±æ€§ãƒã‚§ãƒƒã‚¯ã€‚"
    fi
  else
    # ãƒ•ãƒ«ï¼ˆ8äººæƒ³å®šï¼‰
    assign_role worker1 "ã‚ãªãŸã¯worker1ã§ã™ã€‚å½¹å‰²: UI/UXå®Ÿè£…ã€‚\nä¸»æ‹…å½“: ãƒ‡ã‚¶ã‚¤ãƒ³ã‚·ã‚¹ãƒ†ãƒ /ãƒ¬ã‚¹ãƒãƒ³ã‚·ãƒ–/ã‚¢ã‚¯ã‚»ã‚·ãƒ“ãƒªãƒ†ã‚£ã€‚"
    assign_role worker2 "ã‚ãªãŸã¯worker2ã§ã™ã€‚å½¹å‰²: ãƒãƒƒã‚¯ã‚¨ãƒ³ãƒ‰/APIã€‚\nä¸»æ‹…å½“: APIè¨­è¨ˆ/ãƒ‡ãƒ¼ã‚¿ãƒ¢ãƒ‡ãƒ«/æ°¸ç¶šåŒ–/ã‚¨ãƒ©ãƒ¼ãƒãƒ³ãƒ‰ãƒªãƒ³ã‚°ã€‚"
    assign_role worker3 "ã‚ãªãŸã¯worker3ã§ã™ã€‚å½¹å‰²: å˜ä½“ãƒ†ã‚¹ãƒˆ/QAã€‚\nä¸»æ‹…å½“: ãƒ¦ãƒ‹ãƒƒãƒˆãƒ†ã‚¹ãƒˆ/ãƒ¢ãƒƒã‚¯/lint/åŸºæœ¬CIã€‚"
    assign_role worker4 "ã‚ãªãŸã¯worker4ã§ã™ã€‚å½¹å‰²: E2E/å›å¸°ãƒ†ã‚¹ãƒˆã€‚\nä¸»æ‹…å½“: ä¸»è¦å°ç·šã®è‡ªå‹•E2Eãƒ»å›å¸°ã‚»ãƒƒãƒˆæ•´å‚™ã€‚"
    assign_role worker5 "ã‚ãªãŸã¯worker5ã§ã™ã€‚å½¹å‰²: ãƒ‘ãƒ•ã‚©ãƒ¼ãƒãƒ³ã‚¹æœ€é©åŒ–ã€‚\nä¸»æ‹…å½“: LCP/CLS/INP/ãƒ¬ã‚¤ãƒ†ãƒ³ã‚·ã®æ”¹å–„ã€‚"
    assign_role worker6 "ã‚ãªãŸã¯worker6ã§ã™ã€‚å½¹å‰²: ã‚»ã‚­ãƒ¥ãƒªãƒ†ã‚£/ãƒ—ãƒ©ã‚¤ãƒã‚·ãƒ¼ã€‚\nä¸»æ‹…å½“: èªè¨¼ãƒ»èªå¯ãƒ»PIIä¿è­·ãƒ»ãƒ˜ãƒƒãƒ€è¨­å®šã€‚"
    assign_role worker7 "ã‚ãªãŸã¯worker7ã§ã™ã€‚å½¹å‰²: ãƒ‰ã‚­ãƒ¥ãƒ¡ãƒ³ãƒˆ/DXã€‚\nä¸»æ‹…å½“: ã‚¬ã‚¤ãƒ‰/ãƒ†ãƒ³ãƒ—ãƒ¬/ã‚µãƒ³ãƒ—ãƒ«/ã‚ªãƒ³ãƒœãƒ¼ãƒ‡ã‚£ãƒ³ã‚°æ•´å‚™ã€‚"
    assign_role worker8 "ã‚ãªãŸã¯worker8ã§ã™ã€‚å½¹å‰²: ç›£è¦–/é‹ç”¨ã€‚\nä¸»æ‹…å½“: ãƒ­ã‚°/ãƒ¡ãƒˆãƒªã‚¯ã‚¹/ã‚¢ãƒ©ãƒ¼ãƒˆ/ç¨¼åƒç›£è¦–ã®åˆæœŸè¨­å®šã€‚"
  fi

  echo "âœ… å½¹å‰²å‰²å½“ã‚³ãƒãƒ³ãƒ‰ã®é€ä¿¡ã‚’å®Œäº†ã—ã¾ã—ãŸï¼ˆæœªèªè¨¼ã®å ´åˆã¯é€ä¿¡ãŒå¤±æ•—ã™ã‚‹ã“ã¨ãŒã‚ã‚Šã¾ã™ï¼‰ã€‚"
fi

echo "ğŸ“‹ ã¾ã¨ã‚:"
echo "  ã‚»ãƒƒã‚·ãƒ§ãƒ³: multiagent, president"
echo "  ãƒ¯ãƒ¼ã‚«ãƒ¼æ•°: $NUM"
echo "  å½¹å‰²å‰²å½“: ${DO_ASSIGN}"
